<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Continuous Integration &#8212; Roman Supernova PIT Python Packaging Guide  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=5a6b8c39" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=4c948548" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced Topics" href="advanced/index.html" />
    <link rel="prev" title="Including data in your package" href="data.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo_black_filled_sm.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">Roman Supernova PIT Python packaging guide and template.</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="minimal.html">Minimal package layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Documenting your Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Testing your package</a></li>
<li class="toctree-l1"><a class="reference internal" href="checklist.html">Checklist for creating a PR</a></li>
<li class="toctree-l1"><a class="reference internal" href="tox.html">Running Commands with Tox</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Compiled C/Cython extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Releasing Your Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Command-line scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Including data in your package</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Continuous Integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced/index.html">Advanced Topics</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="data.html" title="previous chapter">Including data in your package</a></li>
      <li>Next: <a href="advanced/index.html" title="next chapter">Advanced Topics</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="data.html" title="Previous document">Including data in your package</a>
        </li>
        <li>
          <a href="advanced/index.html" title="Next document">Advanced Topics</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="continuous-integration">
<span id="ci"></span><h1>Continuous Integration<a class="headerlink" href="#continuous-integration" title="Link to this heading">¶</a></h1>
<p>Continuous Integration (CI) is the method by which software is tested and built before deployment to users.
A set of ‘jobs’ are defined in a <code class="docutils literal notranslate"><span class="pre">.yml</span></code> file, roughly taking the flow build - test - deploy.
Each run is built from a clean environment.
Workflows can be set to begin on triggers for example, a <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> or a new tag.</p>
<p>There are an array solutions for running CI, Open Astronomy recommends <a class="reference external" href="https://docs.github.com/en/actions/">GitHub Actions</a> for projects using GitHub.
GitHub Actions workflows are defined in the <code class="docutils literal notranslate"><span class="pre">.github/workflows/</span></code> folder at the root of the repo.
Open Astronomy maintains a <a class="reference external" href="https://github.com/OpenAstronomy/github-actions-workflow">set of tools</a> to make configuring GitHub Actions easier. A <a class="reference external" href="https://github.com/skills/hello-github-actions">free course</a> for GitHub Actions is available.</p>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<section id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h3>
<p>In order GitHub Actions to run your workflow, it requires; an event to trigger the workflow, one or more jobs to complete and all steps must either run a script or trigger an action.
Looking at this in context:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run template tests</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenAstronomy/github-actions-workflows/.github/workflows/tox.yml@v1</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">envs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">- linux: py311-test</span>
</pre></div>
</div>
<p>In this case the workflow is triggered on a push to a branch, a PR, or a manual trigger of the workflow (<cite>workflow_dispatch</cite>).
The second line of the job defines the name of the job, in this case <code class="docutils literal notranslate"><span class="pre">test</span></code>, and uses Open Astronomy’s pre-defined workflow to run the tests with tox.
The <code class="docutils literal notranslate"><span class="pre">envs</span></code> list, defines which tox environments will be run for that job.</p>
</section>
<section id="publishing-to-pypi">
<h3>Publishing to PyPI<a class="headerlink" href="#publishing-to-pypi" title="Link to this heading">¶</a></h3>
<section id="no-compiled-extensions">
<h4>No Compiled Extensions<a class="headerlink" href="#no-compiled-extensions" title="Link to this heading">¶</a></h4>
<p>Python packages should be published on <a class="reference external" href="https://pypi.org/">PyPI</a>, which can be automated on CI.
This can improve security (as fewer people need access to publish on PyPI) and make it less effort for maintainers to publish a release.
When we are building and publishing releases to PyPI we only want this to happen on a <a class="reference external" href="https://git-scm.com/book/en/v2/Git-Basics-Tagging">git tag</a>, as opposed to on every commit.
However, if we only run the build job on tags, we never have a way to test that the job works before we tag a release of our package.
The OpenAstronomy publish workflows will (by default) only publish to PyPI on a tag which starts with <cite>v</cite> (<a class="reference external" href="https://github-actions-workflows.openastronomy.org/en/stable/publish.html#upload-to-pypi">see here</a>).
Therefore, we recommend running the workflow on both push to your default branch (<cite>main</cite>), on tags and on manual runs.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">on</span><span class="p">:</span>
<span class="w">   </span><span class="nt">push</span><span class="p">:</span>
<span class="w">     </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;main&#39;</span>
<span class="w">   </span><span class="nt">tag</span><span class="p">:</span>
<span class="w">   </span><span class="nt">workflow_dispatch</span><span class="p">:</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">publish</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenAstronomy/github-actions-workflows/.github/workflows/publish_pure_python.yml@v1</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test_extras</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">      </span><span class="nt">test_command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest --pyargs &lt;package name&gt;</span>
<span class="w">  </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pypi_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.pypi_token }}</span>
</pre></div>
</div>
<p>Replace references to <cite>&lt;package_name&gt;</cite> with the package to be published.</p>
<p>To publish to PyPI we need a PyPI token, associated with your PyPI account.
<a class="reference external" href="https://pypi.org/help/#apitoken">Instructions on creating up your key here</a>.
The secret can be stored at <a class="reference external" href="https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions#creating-secrets-for-an-organization">organisation</a> or <a class="reference external" href="https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions#creating-secrets-for-a-repository">repo level</a> in GitHub settings.</p>
</section>
<section id="with-compiled-extensions">
<h4>With Compiled Extensions<a class="headerlink" href="#with-compiled-extensions" title="Link to this heading">¶</a></h4>
<p>Almost all packages on pypi also have environment specific binaries with all dependencies packaged.
It is expected that a package publishes both a pure python distribution and the binary, see <a class="reference external" href="https://pypi.org/project/sunpy/#files">here for examples</a>.</p>
<p>In this case, in addition to the running the tests, the <code class="docutils literal notranslate"><span class="pre">with</span></code> block also includes targets.
‘Targets’ are the distributions which the binary will be built for, so in this case it would be linux and MacOS 64 bit.
The <code class="docutils literal notranslate"><span class="pre">publish</span></code> method from the Open Astronomy GitHub actions packages the module with the dependencies for the specific targets listed</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">publish</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenAstronomy/github-actions-workflows/.github/workflows/publish.yml@v1</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test_extras</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">      </span><span class="nt">test_command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest --pyargs test_package</span>
<span class="w">      </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">- linux</span>
<span class="w">        </span><span class="no">- cp3?-macosx_x86_64</span>
<span class="w">  </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pypi_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.pypi_token }}</span>
</pre></div>
</div>
</section>
<section id="putting-it-all-together">
<h4>Putting it all together<a class="headerlink" href="#putting-it-all-together" title="Link to this heading">¶</a></h4>
<p>Combining the above steps reveals a total workflow, build, testing and publishing</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">package_deployment</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">  </span><span class="nt">tag</span><span class="p">:</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenAstronomy/github-actions-workflows/.github/workflows/tox.yml@v1</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">envs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">- linux: py311</span>

<span class="w">  </span><span class="nt">publish_python</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenAstronomy/github-actions-workflows/.github/workflows/publish_pure_python.yml@v1</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">with</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="nt">test_extras</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">        </span><span class="nt">test_command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest --pyargs test_package</span>
<span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pypi_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.pypi_token }}</span>

<span class="w">  </span><span class="nt">publish_binaries</span><span class="p">:</span>
<span class="w">   </span><span class="nt">publish</span><span class="p">:</span>
<span class="w">     </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenAstronomy/github-actions-workflows/.github/workflows/publish.yml@v1</span>
<span class="w">     </span><span class="nt">with</span><span class="p">:</span>
<span class="w">       </span><span class="nt">test_extras</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">       </span><span class="nt">test_command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest --pyargs test_package</span>
<span class="w">       </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">         </span><span class="no">- linux</span>
<span class="w">         </span><span class="no">- cp3?-macosx_x86_64</span>
<span class="w">   </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w">     </span><span class="nt">pypi_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.pypi_token }}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.github/workflows/</span></code> directory may contain several workflows such as the above.
Each file may contain different workflows, with different triggers dependent on requirements.</p>
</section>
</section>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="data.html" title="Previous document">Including data in your package</a>
        </li>
        <li>
          <a href="advanced/index.html" title="Next document">Advanced Topics</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2024, Roman Supernova PIT.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/ci.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>