<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Compiled C/Cython extensions &#8212; Roman Supernova PIT Python Packaging Guide  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=5a6b8c39" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=4c948548" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Releasing Your Package" href="releasing.html" />
    <link rel="prev" title="Running Commands with Tox" href="tox.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo_black_filled.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">Roman Supernova PIT Python packaging guide and template.</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="minimal.html">Minimal package layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Documenting your Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Testing your package</a></li>
<li class="toctree-l1"><a class="reference internal" href="checklist.html">Checklist for creating a PR</a></li>
<li class="toctree-l1"><a class="reference internal" href="tox.html">Running Commands with Tox</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Compiled C/Cython extensions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#defining-extensions-in-setup-py">Defining extensions in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#packages-with-many-extensions">Packages with many extensions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Releasing Your Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Command-line scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Including data in your package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced/index.html">Advanced Topics</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tox.html" title="previous chapter">Running Commands with Tox</a></li>
      <li>Next: <a href="releasing.html" title="next chapter">Releasing Your Package</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="tox.html" title="Previous document">Running Commands with Tox</a>
        </li>
        <li>
          <a href="releasing.html" title="Next document">Releasing Your Package</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="compiled-c-cython-extensions">
<span id="extensions"></span><h1>Compiled C/Cython extensions<a class="headerlink" href="#compiled-c-cython-extensions" title="Link to this heading">¶</a></h1>
<p>Python packages can include compiled extensions in a variety of languages, most
commonly C and <a class="reference external" href="https://cython.org/">Cython</a> (Cython is a language close to
Python that can be automatically translated into C). An extension, once
compiled, looks just like a regular Python module/sub-module.</p>
<p>There are a number of reasons why you might want to include compiled extensions
including for example to speed up code that is otherwise slow in Python, or
because you want to include an existing stable library without having to
re-implement it in Python.</p>
<section id="defining-extensions-in-setup-py">
<h2>Defining extensions in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code><a class="headerlink" href="#defining-extensions-in-setup-py" title="Link to this heading">¶</a></h2>
<p>To define an extension, we need to create an instance of
<code class="xref py py-class docutils literal notranslate"><span class="pre">distutils.core.Extension</span></code> inside the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file. For a simple
case with a single <code class="docutils literal notranslate"><span class="pre">.c</span></code> file, this would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">distutils.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Extension</span>
<span class="n">ext</span> <span class="o">=</span> <span class="n">Extension</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;my_package.my_extension&#39;</span><span class="p">,</span>
                <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;my_package/my_extension.c&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">name</span></code> is the final name the compiled extension will have, which means
that if the extension defines a function <code class="docutils literal notranslate"><span class="pre">fast_function</span></code> it can be imported
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">my_package.my_extension</span><span class="w"> </span><span class="kn">import</span> <span class="n">fast_function</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sources</span></code> argument should be set to a list of source files to compile and
link together to create the extension, and the filenames should be relative to
the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file. If your extension uses the Numpy C API, you should also
specify the Numpy include directory using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ext</span> <span class="o">=</span> <span class="n">Extension</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;my_package.my_extension&#39;</span><span class="p">,</span>
                <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;my_package/my_extension.c&#39;</span><span class="p">],</span>
                <span class="n">include_dirs</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">get_include</span><span class="p">()])</span>
</pre></div>
</div>
<p>There are a number of other options that can be passed to set for example what
other libraries to link to, flags or macros to pass to the compiler, and so on.
For more information about these, see the <code class="xref py py-class docutils literal notranslate"><span class="pre">Extension</span> <span class="pre">section</span></code> in the Python documentation.</p>
<p>Once your extension has been defined, you should pass a list of extensions
to the <code class="docutils literal notranslate"><span class="pre">ext_modules</span></code> keyword argument to the <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function in the
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ext_modules</span><span class="o">=</span><span class="p">[</span><span class="n">ext</span><span class="p">])</span>
</pre></div>
</div>
<p>If you want to build a Cython extension instead of a C extension, specify the
<code class="docutils literal notranslate"><span class="pre">.pyx</span></code> file(s) in the <code class="docutils literal notranslate"><span class="pre">sources</span></code> argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ext</span> <span class="o">=</span> <span class="n">Extension</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;my_package.my_extension&#39;</span><span class="p">,</span>
                <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;my_package/my_extension.pyx&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>And make sure you also add <code class="docutils literal notranslate"><span class="pre">cython</span></code> to your <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> build-time
dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">build</span><span class="o">-</span><span class="n">system</span><span class="p">]</span>
<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="s2">&quot;cython&quot;</span><span class="p">]</span>
<span class="n">build</span><span class="o">-</span><span class="n">backend</span> <span class="o">=</span> <span class="s1">&#39;setuptools.build_meta&#39;</span>
</pre></div>
</div>
</section>
<section id="packages-with-many-extensions">
<h2>Packages with many extensions<a class="headerlink" href="#packages-with-many-extensions" title="Link to this heading">¶</a></h2>
<p>For packages with many extensions, you might want to consider using the
<a class="reference external" href="https://pypi.org/project/extension-helpers/">extension-helpers</a> package. This
package serves two main purposes:</p>
<ul class="simple">
<li><p>For single-file Cython extensions, it will automatically discover and
define these extensions.</p></li>
<li><p>For other extensions, it allows you to define extensions inside
<code class="docutils literal notranslate"><span class="pre">setup_package.py</span></code> files which can be anywhere in your package. These files
should contain a single function called <code class="docutils literal notranslate"><span class="pre">get_extensions</span></code> that returns a list
of extensions. The idea is then to make it easier to manage extensions for
large packages by placing the <code class="docutils literal notranslate"><span class="pre">setup_package.py</span></code> files close to the
extension code.</p></li>
</ul>
<p>To use extension-helpers, first make sure it is included in your <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>
file as a build-time dependency:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">build</span><span class="o">-</span><span class="n">system</span><span class="p">]</span>
<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="s2">&quot;extension-helpers&quot;</span><span class="p">]</span>
<span class="n">build</span><span class="o">-</span><span class="n">backend</span> <span class="o">=</span> <span class="s1">&#39;setuptools.build_meta&#39;</span>
</pre></div>
</div>
<p>Then adjust your <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> to include:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">extension_helpers.setup_helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_extensions</span>

<span class="n">setup</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ext_modules</span><span class="o">=</span><span class="n">get_extensions</span><span class="p">())</span>
</pre></div>
</div>
<p>Finally, if needed, create <code class="docutils literal notranslate"><span class="pre">setup_package.py</span></code> files in sub-modules where you
have extensions, add a <code class="docutils literal notranslate"><span class="pre">get_extensions()</span></code> function, and make sure that it
returns a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Extension</span></code>  objects.</p>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="tox.html" title="Previous document">Running Commands with Tox</a>
        </li>
        <li>
          <a href="releasing.html" title="Next document">Releasing Your Package</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2024, Roman Supernova PIT.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/extensions.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>