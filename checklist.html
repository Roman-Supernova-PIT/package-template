<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Checklist for creating a PR &#8212; Roman Supernova PIT Python Packaging Guide  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=5a6b8c39" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=4c948548" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running Commands with Tox" href="tox.html" />
    <link rel="prev" title="Testing your package" href="tests.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo_black_filled_sm.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">Roman Supernova PIT Python packaging guide and template.</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="minimal.html">Minimal package layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Documenting your Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Testing your package</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Checklist for creating a PR</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#edit-your-code">Edit your code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#write-tests">Write tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-the-pr">Create the PR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-a-news-fragment">Add a news fragment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-sure-automatic-checks-pass">Make sure automatic checks pass</a></li>
<li class="toctree-l2"><a class="reference internal" href="#merge-the-pr">Merge the PR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#after-merging-the-pr-to-main-bump-the-version-if-appropriate">After merging the PR to main — bump the version if appropriate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tox.html">Running Commands with Tox</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Compiled C/Cython extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Releasing Your Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Command-line scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Including data in your package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced/index.html">Advanced Topics</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tests.html" title="previous chapter">Testing your package</a></li>
      <li>Next: <a href="tox.html" title="next chapter">Running Commands with Tox</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="tests.html" title="Previous document">Testing your package</a>
        </li>
        <li>
          <a href="tox.html" title="Next document">Running Commands with Tox</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="checklist-for-creating-a-pr">
<span id="checklist"></span><h1>Checklist for creating a PR<a class="headerlink" href="#checklist-for-creating-a-pr" title="Link to this heading">¶</a></h1>
<p>The right way to edit code is not to commit directly to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch, but to work in either a forked repository, or in another branch, and then to submit a pull request (PR) to merge your branch to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch.  Then, somebody else will review your code so that we have two sets of eyes on any code before it gets merged into the main branch.  When all is well, the PR will be merged.</p>
<p>This is the set of steps necessary to create a new PR whose tests from this template will pass.</p>
<section id="edit-your-code">
<h2>Edit your code<a class="headerlink" href="#edit-your-code" title="Link to this heading">¶</a></h2>
<p>Do what you would normally do in a PR: add the new feature or bug fix to the forked repo or to the non-<code class="docutils literal notranslate"><span class="pre">main</span></code> branch you’re working in.</p>
</section>
<section id="write-tests">
<h2>Write tests<a class="headerlink" href="#write-tests" title="Link to this heading">¶</a></h2>
<p>For anything you change are add, make sure to write tests that verify the changed/fixed behavior, and/or that test the new behavior you’ve added; see <a class="reference external" href="testing">Testing your package</a>.</p>
<p>You probably also want to make sure that you’re tests are set up to run automatically on github; see <a class="reference internal" href="index.html#adding-tests-to-github-workflow"><span class="std std-ref">Adding tests to github workflow</span></a>.</p>
</section>
<section id="create-the-pr">
<h2>Create the PR<a class="headerlink" href="#create-the-pr" title="Link to this heading">¶</a></h2>
<p>Documentation TODO – will suggest creating a draft PR initially, and only converting it to a real PR once it’s ready for review.</p>
</section>
<section id="add-a-news-fragment">
<h2>Add a news fragment<a class="headerlink" href="#add-a-news-fragment" title="Link to this heading">¶</a></h2>
<p>You need to add a small file that will be appended to the changelog of your package.  (This changelog as a single file does not exist in your repo, but will exist when you package it up to send to PyPi.)</p>
<section id="make-sure-you-have-the-right-things-in-your-environment">
<h3>Make sure you have the right things in your environment<a class="headerlink" href="#make-sure-you-have-the-right-things-in-your-environment" title="Link to this heading">¶</a></h3>
<p>Ideally, if you’re using the standard SN PIT environment (either via Conda or in a Docker image), everything will already be there, and you can ignore this section.</p>
<p>You need to have</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">towncrier</span></code></p></li>
</ul>
</section>
<section id="creating-the-news-fragment">
<h3>Creating the news fragment<a class="headerlink" href="#creating-the-news-fragment" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">towncrier</span></code>, which is run as part of the standard github actions tests, requires all PRs to have at least one new “news fragment”.  In the top level directory of your repo, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">towncrier</span> <span class="n">create</span> <span class="o">&lt;</span><span class="n">PR</span><span class="c1">#&gt;.&lt;extension&gt;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;PR#&gt;</span></code> is the number of your pull request.  <code class="docutils literal notranslate"><span class="pre">&lt;extension&gt;</span></code> should be one of <code class="docutils literal notranslate"><span class="pre">docs</span></code>, <code class="docutils literal notranslate"><span class="pre">bugfix</span></code>, <code class="docutils literal notranslate"><span class="pre">feature</span></code>, or the name of your package.  There is a bit of a chicken-and-egg problem here in that you have to create the pull request before you know this number; in so doing, the tests will fail, because you won’t have created the news fragment yet.  So, just accept that the tests will fail right after you create the PR.  Create it, and having done so figure out what the number of the PR is.  Then, run the command above.  This will create a new file <code class="docutils literal notranslate"><span class="pre">changes/&lt;PR#&gt;.&lt;extension&gt;.rst</span></code>.  Edit that file and put in a short one-line desription of what you’ve done.  Perhaps reference any Issue numbers that you are addressing.  Add that file with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code>, and then <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> again.  This step of the tests on github should now pass.  (No promises for any other tests.)</p>
<p>So, for example, suppose your package is <code class="docutils literal notranslate"><span class="pre">guide</span></code>, and you’ve just fixed a bug.  You know that you are doing pull request #42 (because you’ve already submitted it, and had the tests fail because you didn’t have any changes in this PR).  In this case, you would run <code class="docutils literal notranslate"><span class="pre">towncrier</span> <span class="pre">create</span> <span class="pre">42.bugfix</span></code>.  That will create a file <code class="docutils literal notranslate"><span class="pre">changes/42.bugfix.rst</span></code>.  You might then edit that file and replace its contents with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">added</span> <span class="n">the</span> <span class="n">answer</span> <span class="p">(</span><span class="n">Issue</span> <span class="c1">#42)</span>
</pre></div>
</div>
<p>You’d then run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">changes/42.bugfix.rst</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code>, and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code>.</p>
</section>
</section>
<section id="make-sure-automatic-checks-pass">
<h2>Make sure automatic checks pass<a class="headerlink" href="#make-sure-automatic-checks-pass" title="Link to this heading">¶</a></h2>
<p>On github, if you click, on the “Pull requests” link at the top of the page for your repo, you will get a list of current PRs, including yours.  Click on your PR, scroll down, and find the box that looks something like:</p>
<img alt="github" src="_images/pr_checks.png" />
<p>Each of the three green checkmarks will be a big red <strong>X</strong> if something is wrong.</p>
<section id="code-review">
<h3>Code Review<a class="headerlink" href="#code-review" title="Link to this heading">¶</a></h3>
<p>Depending on how your code is set up, this may start with a green check, or may start with a red <strong>X</strong>.  If the text, like in the example, says that the review is not required to merge, you should still get that review and not merge until you have confirmation from whoever is doing that review.  (We may adjust the package template so it defaults to requiring a review.)  If somebody has reviewed the code and indicated to github that they approve it, then this will be a green check, but as noted, a green check doesn’t guarantee that that has happened.</p>
<p>However, before asking people for a code review, you should make sure that the next two checks are already green (or acceptably red).</p>
</section>
<section id="checks-tests">
<h3>Checks/Tests<a class="headerlink" href="#checks-tests" title="Link to this heading">¶</a></h3>
<p>The middle check in the image above has to do with the tests that are set up to run automatically when you create the PR, or when you push any changes to the branch the PR is pulling from.  If this is a moving brown circle, it means the tests are still in progress.  If it’s a red <strong>X</strong>, then something failed.  Click on the name of the failed tests to see the output and try to figure out what went wrong.  You’ll want to either fix these, or (in exceptional circumstances) understand why the tests fails and why its OK, before getting a code review.</p>
</section>
<section id="conflicts-with-base-branch">
<h3>Conflicts with base branch<a class="headerlink" href="#conflicts-with-base-branch" title="Link to this heading">¶</a></h3>
<p>The third thing in the list above is actually the first thing you should think about.  If the third thing in the list is marked as not working, that almost certainly means that there have been commits to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch of the repo that are not included in the branch that you’re submitting for a pull request.  You will need to merge the branch into your branch (the exact procedure for which differs based on whether you’re in a forked repo or a branch of the primary repo), and deal with any conflicts in that merge.  Push your new branch, and ideally this check should clear up.</p>
</section>
</section>
<section id="merge-the-pr">
<h2>Merge the PR<a class="headerlink" href="#merge-the-pr" title="Link to this heading">¶</a></h2>
<p>When all is ready, either you or the code reviewer should merge the PR to main.  It’s up to you how you want to merge.  By default, when you merge, all of the various commit messages on your branch will be added to the commit history of main.  This can lead to a long and verbose commit history in the production version of your repo, which may be what you want.  However, if you want a cleaner commit history on the main branch, then <strong>do not just press the big friendly “Merge pull request” button</strong>.  Rather, click the little down arrow, and find the option “Squash and Merge”.  What that will do is remove all of the sundry complicated and perhaps sordid commit messages from your branch, and replace it with a single clean commit message for your PR on the main branch.  Put the text for this single clean commit in the top text box, and then delete everything in the bigger text box.  Finally, push the “Squash and Merge” button.</p>
</section>
<section id="after-merging-the-pr-to-main-bump-the-version-if-appropriate">
<span id="incrementing-version"></span><h2>After merging the PR to main — bump the version if appropriate<a class="headerlink" href="#after-merging-the-pr-to-main-bump-the-version-if-appropriate" title="Link to this heading">¶</a></h2>
<p>(If you’re nervous about this, talk to one of the pipeline managers (including, but not limited to, Megan and Rob) about what to do.)</p>
<p>After all code reviews and modifications are done and you have merged to <cite>main</cite>, you most likely will need to bump the version of the software.  This will affect the version that is attached to the software if a pip package is built, for example.</p>
<p>Figure out what the current version of the package is by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">pull</span> <span class="o">-</span><span class="n">a</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="n">main</span>
<span class="n">git</span> <span class="n">tag</span>
</pre></div>
</div>
<p>That will list the tags that are currently defined for the repo.  Find the ones that look like <a class="reference external" href="https://semver.org/">semantic versioning</a> (you really only need to read the short “Summary” section on that link, but read the rest if you’re morbidly curious).  Decide which numbers you need to change based on what changes are in this PR.  Once you’ve figured out what your new version is going to be, create a git tag with this new version.  So, for example, suppose the highest tagged version you found existing was <cite>1.9.5</cite>.  Suppose you’ve added new functionality, but in a backwards compatible manner.  (So, you have new functions or methods, but you didn’t change anything so all code that uses your code will still work as-is.)  In this case, you would want to bump the minor version number, and your new version would be <cite>1.10.0</cite>.  You would then run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">tag</span> <span class="mf">1.10.1</span>
<span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="o">--</span><span class="n">tags</span>
</pre></div>
</div>
<p>That will push the new tag you made to the <cite>main</cite> branch on the github archive.  Thereaftrer, if somebody builds a package from that commit of the git archive, that package will bake into it the version in the tag you just created.</p>
<p>You can check that the version is right by importing your package (assuming you’ve done a <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code> or some such to have the current code tree in your environment) and looking at it’s version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span>
<span class="nb">print</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;.</span><span class="n">__version__</span> <span class="p">)</span>
</pre></div>
</div>
<p>Finally, you should <a class="reference internal" href="releasing.html#releasing"><span class="std std-ref">release your package</span></a> if the package is far along enough that you have it pip installable from PyPI.</p>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="tests.html" title="Previous document">Testing your package</a>
        </li>
        <li>
          <a href="tox.html" title="Next document">Running Commands with Tox</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2024, Roman Supernova PIT.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.0.4</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/checklist.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>